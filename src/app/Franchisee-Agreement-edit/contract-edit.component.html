<div class="container-fluid">
    <div class="card">
        <div class="card-header">
            <h4 class="card-title">Add Supplier Contract</h4>
        </div>
        <div class="card-body">
            <form [formGroup]="contractForm" (ngSubmit)="saveContract()">
                <div class="row">

                    <!-- Vendor Dropdown (Searchable) -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Vendor</label>
                        <ng-select
                        [items]="vendors"
                        bindLabel="CompanyName"
                        bindValue="Id"
                        placeholder="Select Vendor"
                        formControlName="vendorID"
                        [ngClass]="{ 'is-invalid': contractForm.get('vendorID')?.invalid && contractForm.get('vendorID')?.touched }"
                        [searchable]="true"
                        [clearable]="true"
                        [disabled]="true"
                        >
                        </ng-select>
                        <div class="invalid-feedback"
                        *ngIf="contractForm.get('vendorID')?.invalid && contractForm.get('vendorID')?.touched">
                        Please select a vendor.
                        </div>
                    </div>
  



                    <!-- Customer Dropdown -->
                    <!-- Customer Dropdown (Searchable) -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Customer</label>
                        <ng-select
                        [items]="customers"
                        bindLabel="DisplayName"
                        bindValue="Id"
                        placeholder="Select Customer"
                        formControlName="customerID"
                        [ngClass]="{ 'is-invalid': contractForm.get('customerID')?.invalid && contractForm.get('customerID')?.touched }"
                        [searchable]="true"
                        [clearable]="true"
                        >
                        </ng-select>
                        <div class="invalid-feedback"
                        *ngIf="contractForm.get('customerID')?.invalid && contractForm.get('customerID')?.touched">
                        Please select a customer.
                        </div>
                    </div>
  


                    <!-- Frequency Dropdown -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Cleaning Frequency</label>
                        <select class="form-select"
                            formControlName="frequencyID"
                            (change)="billingFrequencyChange()"
                            [ngClass]="{ 'is-invalid': contractForm.get('frequencyID')?.invalid && contractForm.get('frequencyID')?.touched }">
                            
                            <option [ngValue]="null" disabled>Select Frequency</option>
                            <option *ngFor="let freq of frequencies" [ngValue]="freq.frequencyID">
                                {{ freq.description }}
                            </option>
                        </select>
                        <div class="invalid-feedback"
                            *ngIf="contractForm.get('frequencyID')?.invalid && contractForm.get('frequencyID')?.touched">
                            Please select a frequency.
                        </div>
                    </div>

                    <!-- Days of Week Checkboxes -->
                    <div class="col-md-12 mb-3">
                        <label class="form-label">Days of Week</label>
                        <div class="d-flex flex-wrap">
                            <div *ngFor="let day of daysOfWeek" class="form-check me-3">
                                <input 
                                    type="checkbox"
                                    class="form-check-input"
                                    [value]="day"
                                    (change)="onDaySelectionChange($event)"
                                    [checked]="selectedDays.includes(day)"
                                />
                                <label class="form-check-label">
                                    {{ day }}
                                </label>
                            </div>
                        </div>
                        <div *ngIf="daySelectionError" class="text-danger mt-1">
                            {{ daySelectionError }}
                        </div>
                    </div>

                    <!-- Product Duration -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Product Duration (months)</label>
                        <select class="form-select" formControlName="productID"
                            [ngClass]="{ 'is-invalid': contractForm.get('productID')?.invalid && contractForm.get('productID')?.touched }">
                            <option [ngValue]="null" disabled>Select Duration</option>
                            <option *ngFor="let product of products" [ngValue]="product.productID">
                                {{ product.durationMonths }} months
                            </option>
                        </select>
                        <div class="invalid-feedback"
                            *ngIf="contractForm.get('productID')?.invalid && contractForm.get('productID')?.touched">
                            Please select a product duration.
                        </div>
                    </div>



                    <!-- Original Amount (Required) -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Original Amount</label>
                        <input type="number" class="form-control" formControlName="originalAmount"
                            placeholder="e.g. 3000.00"
                            [ngClass]="{ 'is-invalid': contractForm.get('originalAmount')?.invalid && contractForm.get('originalAmount')?.touched }" />
                        <div class="invalid-feedback"
                            *ngIf="contractForm.get('originalAmount')?.invalid && contractForm.get('originalAmount')?.touched">
                        Please enter the original amount.
                        </div>
                    </div>
                    
                    <!-- Financed Amount -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Financed Amount</label>
                        <input type="number" class="form-control" formControlName="financedAmount"
                            placeholder="e.g. 2400.00" />
                    </div>
                    
                    <!-- ðŸ”½ New Field: Down Payment -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Down Payment</label>
                        <input type="number" class="form-control" formControlName="downpayment"
                            placeholder="e.g. 600.00" />
                    </div>
                    
                    <!-- ðŸ”½ New Field: Customer Monthly Amount -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Customer Monthly Amount</label>
                        <input type="number" class="form-control" formControlName="customerMonthlyAmount"
                            placeholder="e.g. 200.00" />
                    </div>
  

                    <!-- Start Date (Required) -->
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Start Date</label>
                        <input type="date" class="form-control" formControlName="startDate"
                            [ngClass]="{ 'is-invalid': contractForm.get('startDate')?.invalid && contractForm.get('startDate')?.touched }" />
                        <div class="invalid-feedback"
                            *ngIf="contractForm.get('startDate')?.invalid && contractForm.get('startDate')?.touched">
                            Start date is required.
                        </div>
                    </div>

                    <!-- End Date (Required) -->
                    <div class="col-md-3 mb-3">
                        <label class="form-label">End Date</label>
                        <input type="date" class="form-control" formControlName="endDate"
                            [ngClass]="{ 'is-invalid': contractForm.get('endDate')?.invalid && contractForm.get('endDate')?.touched }" />
                        <div class="invalid-feedback"
                            *ngIf="contractForm.get('endDate')?.invalid && contractForm.get('endDate')?.touched">
                            End date is required.
                        </div>
                    </div>

                    <!-- Notes -->
                    <div class="col-md-12 mb-3">
                        <label class="form-label">Notes</label>
                        <textarea class="form-control" formControlName="notes" rows="3"
                            placeholder="Optional notes..."></textarea>
                    </div>

                    <div class="col-md-3 mb-3">
                        <label class="form-label">Initial Payments Made</label>
                        <select class="form-select" formControlName="initialPaymentsMade">
                          <option [ngValue]="null" selected>Select Initial Payment</option>
                          <option [ngValue]="0">0</option>
                          <option [ngValue]="1">1</option>
                          <option [ngValue]="2">2</option>
                          <option [ngValue]="3">3</option>
                          <option [ngValue]="4">4</option>
                          <option [ngValue]="5">5</option>
                          <option [ngValue]="6">6</option>
                          <option [ngValue]="7">7</option>
                          <option [ngValue]="8">8</option>
                          <option [ngValue]="9">9</option>
                          <option [ngValue]="10">10</option>
                          <option [ngValue]="11">11</option>
                          <option [ngValue]="12">12</option>
                          <option [ngValue]="13">13</option>
                          <option [ngValue]="14">14</option>
                          <option [ngValue]="15">15</option>
                        </select>
                      </div>
                      <div class="col-md-3 mb-3">
                        <label class="form-label">Calculated Monthly</label>
                        <div class="form-control bg-light">{{ contractForm.value.monthlyAmount | currency:'CAD' }}</div>
                      </div>
                      
                      <div class="col-md-3 mb-3">
                        <label class="form-label">Remaining Payments</label>
                        <div class="form-control bg-light">{{ adjustedPayments }}</div>
                      </div>
                      
                      <div class="col-md-3 mb-3">
                        <label class="form-label">Total Remaining Balance</label>
                        <div class="form-control bg-light">{{ runningTotal | currency }}</div>
                      </div>
                      
                      

                </div>
                <button type="submit" class="btn btn-primary">Save Contract</button>
            </form>
                



         
        </div>
    </div>
</div>